# CFM 碳足跡管理系統之建置與功能實作

## 一、系統概述

隨著全球氣候變遷議題日益受到重視，企業永續發展與碳排放管理已成為現代企業營運的重要課題。為符合國際碳排放管理標準及 ESG（環境、社會、治理）要求，本研究開發了一套完整的企業級碳足跡管理系統（Carbon Footprint Management System, CFM）。該系統整合了碳排放數據監控、智能決策優化、永續報告書自動生成及 AI 輔助查詢等功能，提供企業一個全方位的永續管理解決方案。

CFM 系統採用現代化的 Web 技術架構，以 Next.js 14 框架為基礎，結合 TypeScript 強型別語言開發，確保系統的穩定性與可維護性。系統後端使用 PostgreSQL 關聯式資料庫儲存碳排放數據，並透過 Prisma ORM 進行資料存取，前端則採用 React 18 建構互動式使用者介面，搭配 Tailwind CSS 實現響應式設計，使系統能夠在不同裝置上提供一致的使用體驗。

## 二、系統架構設計

### 2.1 整體架構

本系統採用現代化的全端開發架構（Full-Stack Architecture），前後端整合於 Next.js 框架中，利用其 App Router 機制實現頁面路由與 API 端點的統一管理。整體架構可分為四個主要層級：

**展示層（Presentation Layer）**：使用 React 18 框架開發前端介面，包含儀表板（Dashboard）、決策模型（Decision Model）、碳盤查與管理報告（Report）及系統設定（Settings）四大核心頁面。介面設計採用玻璃態效果（Glass-morphism）與漸層配色，並整合 Recharts 與 Chart.js 圖表庫，提供豐富的資料視覺化功能。

**應用層（Application Layer）**：透過 Next.js API Routes 實現 RESTful API 端點，共開發 23 個 API 端點，涵蓋碳排數據管理（7個端點）、決策模型優化（5個端點）、碳盤查與管理報告生成（6個端點）及系統設定（5個端點）等功能。每個 API 端點皆包含完善的錯誤處理與資料驗證機制。

**業務邏輯層（Business Logic Layer）**：核心業務邏輯包括決策模型優化演算法（位於 `/src/lib/model.ts`）、碳排放數據計算與統計分析功能。決策模型採用網格搜索（Grid Search）演算法，整合 25+ 個經濟與綠色製造參數，透過數學優化模型計算最佳生產策略與碳減排方案。

**資料存取層（Data Access Layer）**：使用 Prisma ORM 進行資料庫操作，定義 10 個主要資料模型，包括公司資料（Company）、碳排放數據（CarbonEmission）、模型參數（ModelParameter）、優化結果（OptimizationResult）、碳盤查與管理報告（SustainabilityReport）等。資料庫採用 PostgreSQL 15，並針對查詢頻繁的欄位（如 companyId、date）建立索引以提升查詢效能。

### 2.2 資料庫設計

資料庫設計遵循正規化原則，避免資料重複並確保資料一致性。核心資料表 CarbonEmission 記錄企業每日碳排放數據，包含 Scope 1（直接排放）、Scope 2（能源間接排放）、Scope 3（其他間接排放）三大分類，以及電力、天然氣、燃料、運輸、廢棄物、用水等細項數據。每筆記錄皆標註資料來源（dataSource）與驗證狀態（verified），確保資料品質與可追溯性。

ModelParameter 資料表儲存決策模型所需的經濟參數與綠色製造參數，包括需求彈性係數（a, b）、市場規模（M）、折扣率（rho）、生產成本（W, V）、運輸成本（Dcost）、訂購成本（S）等基本經濟參數，以及綠色投資效益係數（A）、能源使用率（UR）、燃料使用量（Uf）、固定與可變生產投資（Ii, Ij）等綠色製造參數。此外，系統支援不確定性分析，每個參數皆可設定變異數（如 SHat, VHat）以進行敏感性分析。

SustainabilityReport 資料表管理碳盤查與管理報告的生命週期，從草稿（DRAFT）、審核（REVIEW）、核准（APPROVED）到發布（PUBLISHED）及封存（ARCHIVED），完整記錄報告的執行摘要、碳足跡分析、減排目標、改善措施、法規遵循、財務影響及利害關係人等內容，並支援 PDF 與 DOCX 格式匯出。

## 三、核心功能模組

### 3.1 碳排儀表板模組

碳排儀表板是系統的核心模組，提供企業碳排放數據的即時監控與多維度分析功能。本模組採用 SWR（Stale-While-Revalidate）資料擷取策略，每 5 秒自動更新數據，確保使用者能夠即時掌握最新的碳排放狀況。

儀表板支援彈性的時間範圍查詢功能，使用者可選擇 7 天、30 天、90 天或 180 天的資料區間，系統會自動計算該期間的總碳排放量、平均日排放量、減排量及減排百分比等關鍵指標。資料視覺化採用多種圖表類型，包括折線圖顯示碳排放趨勢、圓餅圖呈現 Scope 1/2/3 排放佔比、柱狀圖比較不同排放源（電力、天然氣、燃料、運輸等）的貢獻度。

儀表板設計四個關鍵指標卡片，分別顯示當前總碳排放量、本月減排量、月度減排目標達成率及碳排放效率評分。每個指標卡片皆包含與前期比較的趨勢指示器，以視覺化方式呈現增減變化，協助管理者快速掌握碳排放管理成效。

資料來源管理功能確保碳排放數據的可信度，系統記錄每筆數據的來源（如自動監測、人工輸入、第三方驗證等）與驗證狀態，並支援批次數據匯入與每日數據自動生成功能，降低人工作業負擔。

### 3.2 決策模型優化系統

決策模型優化系統是本研究的創新功能，整合綠色製造與經濟效益的數學優化模型，協助企業在追求利潤最大化的同時，實現碳排放減量目標。

本模組基於數學規劃理論，建立包含零售價格（p）、固定生產週期（Tf）、零售週期（TR）及綠色投資金額（G）四個決策變數的利潤最大化模型。模型考量需求函數、生產成本、運輸成本、訂購成本、持有成本、綠色投資效益等因素，並透過網格搜索演算法求解最佳策略組合。

優化演算法採用兩階段搜索策略：第一階段進行粗略網格搜索，在整個可行解空間中快速定位全域最佳解的大致範圍；第二階段在最佳解附近進行精細搜索，提高解的精確度。演算法自動檢查約束條件，確保需求函數值大於零，避免產生不合理的解。

系統支援 25+ 個參數的彈性配置，使用者可根據企業實際狀況調整參數值，模型會即時重新計算最佳策略。優化結果除了顯示最佳決策變數組合與預期利潤外，還提供總週期、總收入、總成本及預期碳減排量等資訊，完整評估決策的經濟與環境效益。

敏感性分析功能是決策支援的重要工具，系統針對每個參數進行 ±5% 的變動分析,計算參數變化對最佳利潤的影響程度與影響百分比，以圖表方式呈現各參數的敏感度排序，協助管理者識別關鍵影響因子，制定更穩健的決策策略。

### 3.3 碳盤查與管理報告自動生成

為符合國際永續報告標準（如 GRI、TCFD、SASB 等）的揭露要求，本系統開發碳盤查與管理報告自動生成功能，大幅降低報告編制的時間成本。

系統提供兩種報告生成模式：快速生成模式與自訂生成模式。快速生成模式會自動擷取最近一個月的碳排放數據與減排成效，套用預設範本產生標準報告；自訂生成模式則允許使用者選擇報告期間、自訂報告標題、編寫執行摘要、設定減排目標、描述改善措施、聲明法規遵循狀況、分析財務影響及列舉利害關係人等內容。

報告生成引擎整合 @react-pdf/renderer 函式庫，支援 PDF 格式匯出，確保報告格式的一致性與專業性。生成的報告包含碳排放總覽、Scope 分類統計、排放源分析、趨勢圖表、減排目標達成率、改善措施說明及法規遵循聲明等完整內容。

報告管理功能支援報告版本控制與狀態追蹤，從草稿建立、內部審核、主管核准到正式發布，每個階段皆有明確的狀態標記。系統記錄報告的建立時間、更新時間及發布時間，並提供報告列表檢視與下載功能，方便企業保存歷史報告供查核使用。

### 3.4 AI 智能助理與自動化工作流程整合

為提升使用者體驗與系統易用性，本系統整合雙層 AI 架構，結合 Anthropic Claude AI 與 OpenAI GPT-4 模型，開發浮動式 AI 智能助理（FloatingAI），並透過 N8N 自動化工作流程平台實現智能碳排放數據查詢與報告生成功能。

#### 3.4.1 前端智能助理介面

AI 助理採用浮動視窗設計，位於畫面右下角，不干擾使用者操作主要功能，但隨時可以展開進行對話。介面設計包含快速問題建議按鈕，使用者可一鍵詢問常見問題如「本月的碳排放量是多少？」、「上個月的 Scope 2 排放趨勢如何？」等，降低輸入負擔。

對話系統採用會話管理機制，透過 localStorage 儲存使用者 ID（格式：`timestamp-random`）、使用者名稱與會話 ID，確保對話的連續性與可追溯性。每次對話會攜帶完整的使用者上下文資訊，包括查詢內容（query）、使用者識別（user_id）、使用者名稱（username）、聊天會話 ID（chat_id）及時間戳記（timestamp），提供完整的查詢追蹤與審計功能。

#### 3.4.2 N8N 智能工作流程架構

本系統的核心創新在於整合 N8N 自動化工作流程平台，建立一個完整的 AI 驅動碳排放數據查詢與分析管道。N8N workflow 由九個主要節點組成，形成完整的資料處理鏈：

**節點一：Webhook Trigger（碳排查詢端點）**
設定 Webhook 端點 `/carbon-query`，採用 POST 方法接收來自前端的查詢請求。此端點作為整個工作流程的觸發點，接收包含使用者查詢與上下文資訊的 JSON payload，並配置為 `responseNode` 模式以確保完整的回應流程。

**節點二：Extract Query Data（資料提取）**
透過 Set 節點提取請求中的關鍵資料欄位，包括 `query`（使用者查詢文字）、`user_id`（使用者唯一識別碼）、`username`（使用者名稱）、`chat_id`（聊天會話識別碼）及 `timestamp`（ISO 8601 格式時間戳記）。資料提取階段確保後續節點能夠正確存取所需資訊，並為查詢記錄與稽核提供完整的追蹤資訊。

**節點三：AI Agent（意圖識別與參數解析）**
整合 OpenAI GPT-4O-Mini 模型進行自然語言理解（NLU），解析使用者查詢意圖並提取查詢參數。系統透過精心設計的 System Prompt 指導 AI 識別查詢類型（data_query、trend_analysis、report_generation、comparison）、時間範圍（支援「本月」、「上月」、特定日期等多種表達方式）、Scope 範圍及其他篩選條件。

AI Agent 的重要特色在於基於時間戳記的動態日期計算能力。系統會將使用者請求的 timestamp 傳遞給 AI，AI 根據此時間戳計算「本月」、「上月」等相對時間的實際日期範圍。例如，若 timestamp 為 2025-11-15，則「本月」解析為 2025-11-01 至 2025-11-15，「上月」解析為 2025-10-01 至 2025-10-31。此設計確保查詢結果的時間基準一致性。

模型設定溫度參數（temperature）為 0.7，在準確性與靈活性之間取得平衡，最大 token 數設定為 2000，確保複雜查詢的完整解析。AI 回應採用純 JSON 格式（不含 markdown 代碼塊），便於後續節點進行程式化處理。

**節點四：Parse Intent（意圖解析與日期處理）**
使用 JavaScript Code 節點對 AI Agent 的輸出進行二次處理與驗證。此節點實作智能關鍵詞檢測機制，優先識別使用者查詢中的時間關鍵詞（如「本月」、「上月」、「這個月」、「上一個月」等），並基於 timestamp 動態計算對應的日期範圍。

關鍵詞檢測採用多語言支援，涵蓋繁體中文與英文常見表達方式。若檢測到明確的時間關鍵詞，系統會優先使用關鍵詞驅動的日期計算；若無明確關鍵詞，則解析 AI Agent 返回的日期參數。所有日期皆經過嚴格驗證，確保符合 YYYY-MM-DD 格式且為有效日期。

此節點同時負責處理異常情況，當日期解析失敗或 AI 返回無效日期時，自動回退至預設時間範圍（上個月），確保系統的穩健性。最終輸出包含 `start_date`、`end_date`、`scope`、`category`、`facility` 等結構化查詢參數，以及原始查詢資訊與除錯資訊。

**節點五：Query Database（資料庫查詢）**
連接至 PostgreSQL 資料庫，執行動態 SQL 查詢擷取碳排放數據。查詢語句基於前一節點解析的參數，從 CarbonEmission 資料表選取指定日期範圍內的記錄，包含 date、scope1、scope2、scope3、totalCarbon、electricity、naturalGas、fuel、transport、waste、water 等欄位。

查詢支援可選的 Scope 篩選條件，當使用者指定特定 Scope 時（如「查詢 Scope 2 排放」），SQL 會動態加入對應的 WHERE 條件。查詢結果依日期升序排序，並限制最大返回 1000 筆記錄，避免大量數據影響效能。節點配置 `alwaysOutputData` 選項，確保即使查詢無結果也能正常流轉至下一節點。

**節點六：Analyze Data（數據分析與統計）**
使用 JavaScript Code 節點對查詢結果進行深度統計分析，計算多維度的碳排放指標。分析邏輯包含：

- **總量統計**：計算總碳排放量、各 Scope 排放總量、各排放源（電力、天然氣、燃料等）總量
- **平均值分析**：計算期間平均排放量、各 Scope 平均排放量
- **極值分析**：識別最高與最低排放日期及對應數值
- **百分比分佈**：計算各 Scope 佔總排放的百分比、各排放源佔比
- **月度統計**：將數據按月份聚合，計算每月總量、平均值及記錄數
- **趨勢分析**：評估排放趨勢方向（上升、下降、穩定），計算首月與末月的變化百分比
- **排放源排序**：識別主要排放源及其貢獻度

所有數值計算皆保留兩位小數，確保報告的精確性與可讀性。分析結果以結構化 JSON 格式輸出，包含 statistics（統計摘要）、scope_breakdown（Scope 分類）、source_breakdown（排放源分類）、monthly_data（月度數據）、trend（趨勢資訊）等多個維度的資訊。

**節點七：AI Agent（報告生成）**
整合 OpenAI GPT-4O-Mini 模型生成專業的碳排放分析報告。此 AI Agent 接收前一節點的完整分析數據，並根據精心設計的 System Prompt 產生結構化報告，內容包含：

- **數據摘要**：彙整總排放量、記錄數量、時間範圍、平均/極值等關鍵指標
- **關鍵發現**：識別主要排放源、Scope 分布特徵、顯著的排放模式或異常
- **趨勢分析**：解讀月度變化趨勢、增減幅度、季節性特徵（若有多月數據）
- **建議與見解**：基於數據提供改善建議、重點關注領域、潛在減排機會

報告採用清晰的結構與段落，使用適當的表情符號增強可讀性，數字格式化為千分位逗號格式，百分比保留兩位小數。語氣專業但親切，避免過於技術性的術語，確保非專業人員也能理解。模型設定溫度參數 0.7，最大 token 數 2000，確保報告品質與完整性。

**節點八：Prepare Response（回應準備）**
使用 JavaScript Code 節點整合所有資訊，構建最終回應結構。此節點負責：

- 提取 AI 生成的報告內容（支援多種格式解析）
- 整合 Analyze Data 的統計數據與 Parse Intent 的查詢資訊
- 添加智能建議：根據總排放量級別提供不同的管理建議
- 添加數據完整性提示：當記錄數過少時發出警告
- 處理異常情況：當資料不可用時返回友善的錯誤訊息
- 附加時間戳記與成功狀態標誌

最終回應包含 `success`（成功標誌）、`response`（AI 報告文字）、`data`（統計摘要）、`query_info`（查詢資訊）、`suggestions`（智能建議）、`timestamp`（處理時間）等完整資訊，以 JSON 格式返回。

**節點九：Webhook Response（回應返回）**
配置 HTTP 回應標頭與格式，將最終結果返回至前端。回應設定為 JSON 格式（`Content-Type: application/json; charset=utf-8`），HTTP 狀態碼 200，並添加 CORS 標頭（`Access-Control-Allow-Origin: *`）允許跨域請求。回應內容使用 `JSON.stringify` 格式化為易讀的 JSON 字串（縮排 2 空格），便於前端解析與除錯。

#### 3.4.3 雙層 AI 架構設計

系統採用創新的雙層 AI 架構，結合 Anthropic Claude 與 OpenAI GPT-4 的優勢：

**第一層：Claude AI（通用對話）**
前端 AI 助理主要使用 Anthropic Claude API，透過 `/api/ai/chat` 端點轉發至 Railway 平台的 Webhook 服務處理一般性的碳排放諮詢、減排建議、技術問答等對話需求。Claude 模型擅長長文本理解與複雜推理，提供高品質的對話體驗。

**第二層：OpenAI GPT-4（專業分析）**
當使用者查詢涉及具體的數據分析需求時，系統自動觸發 N8N workflow，利用 OpenAI GPT-4O-Mini 進行意圖解析與報告生成。此層專注於結構化數據處理與專業報告撰寫，提供精確的數據分析與視覺化建議。

雙層架構的優勢在於將通用對話與專業分析分離，各司其職。通用對話無需連接資料庫，響應速度快；專業分析則完整整合資料庫查詢與統計計算，提供深度洞察。使用者無需理解技術細節，系統自動選擇適當的處理路徑，提供無縫的智能體驗。

#### 3.4.4 工作流程稽核與監控

N8N 平台提供完整的工作流程執行記錄，每次查詢皆記錄執行時間、節點狀態、輸入輸出數據及錯誤資訊。系統管理者可透過 N8N 介面監控查詢量、成功率、平均響應時間等指標，識別效能瓶頸與優化機會。

所有使用者查詢皆攜帶 user_id、username、chat_id 與 timestamp，確保完整的審計追蹤。企業可依據這些資訊分析使用者行為模式、常見查詢類型、高峰時段等，持續優化系統設計與使用者體驗。

### 3.5 系統設定與管理

系統設定模組提供完整的企業資料管理、減排目標設定及系統配置功能。企業資料管理功能包含公司名稱、產業別、地址、聯絡人、統一編號等基本資料的建立、查詢、更新與刪除（CRUD）操作。

減排目標管理功能支援多年度目標設定，使用者可設定基準年、基準排放量、目標年及目標減排量，系統會自動計算目前進度與達成率。目標類型包含絕對減量（Absolute Reduction）與相對減量（Intensity Reduction）兩種，符合不同企業的減排策略需求。

系統配置功能採用鍵值對（Key-Value）儲存機制，支援文字、數值、布林值及 JSON 等多種資料型態的配置項目。配置項目依類別（category）分類管理，包含一般設定、安全設定、通知設定、整合設定等，每個配置項目皆附有標籤（label）與描述（description），方便管理者理解設定用途。

## 四、技術實作細節

### 4.1 前端技術實作

前端開發採用 Next.js 14 框架的 App Router 架構，相較於傳統的 Pages Router，App Router 提供更好的效能優化與開發體驗。系統使用 TypeScript 5.4.5 進行開發，透過強型別系統在編譯階段捕捉潛在錯誤，提升程式碼品質。

狀態管理與資料擷取使用 SWR 函式庫，該函式庫基於 Stale-While-Revalidate 的 HTTP 快取策略，提供自動重新驗證、錯誤重試、焦點重新驗證等功能。儀表板頁面設定 5 秒的自動更新間隔（`refreshInterval: 5000`），確保數據的即時性。

介面樣式採用 Tailwind CSS 3.4.3 工具類別框架，並自訂主題配色、動畫效果與響應式斷點。系統定義 fade-in、slide-up、slide-down、pulse-slow 等自訂動畫，提升介面的互動性。漸層配色採用藍-綠-青色系（blue, green, cyan），呼應永續環保的主題。

圖表視覺化整合兩套主流圖表函式庫：Recharts 2.12.6 用於繪製響應式的折線圖、圓餅圖與柱狀圖，具有良好的 React 整合性；Chart.js 4.4.2 搭配 react-chartjs-2 5.2.0 用於繪製進階圖表與動畫效果。兩者互補使用，提供豐富的資料視覺化選項。

### 4.2 後端技術實作

後端 API 開發使用 Next.js API Routes 機制，在 `/src/app/api/` 目錄下建立符合 RESTful 設計原則的 API 端點。每個端點皆實作 HTTP 方法處理函式（如 GET, POST, PUT, DELETE），並包含請求驗證、業務邏輯執行、錯誤處理與回應格式化等完整流程。

資料存取採用 Prisma 6.18.0 ORM 框架，在 `/prisma/schema.prisma` 定義資料模型，透過 `npx prisma generate` 指令自動生成型別安全的資料庫客戶端。Prisma 提供直觀的查詢 API，例如查詢碳排放數據：

```typescript
const emissions = await prisma.carbonEmission.findMany({
  where: {
    companyId: companyId,
    date: {
      gte: startDate,
      lte: endDate,
    },
  },
  orderBy: { date: 'asc' },
});
```

系統針對高頻率查詢的欄位建立資料庫索引，如 `@@index([companyId, date])` 與 `@@index([date])`，大幅提升查詢效能。

錯誤處理採用統一的錯誤回應格式，包含 HTTP 狀態碼、錯誤訊息與錯誤代碼，方便前端進行錯誤識別與處理。API 端點設定適當的超時時間（如 AI 對話端點設定 60 秒超時），避免長時間等待影響使用者體驗。

### 4.3 部署架構

系統採用分散式微服務架構，各組件獨立部署於不同平台，確保高可用性與可擴展性：

**前端與 API 層（Vercel）**
主應用程式採用 Serverless 架構部署於 Vercel 平台，利用其自動化 CI/CD 流程，每次推送至 GitHub 儲存庫時自動觸發建置與部署。Vercel 提供全球 CDN 加速、自動 HTTPS 憑證、環境變數管理、邊緣函數等功能，確保全球使用者皆能獲得低延遲的存取體驗。

**資料庫層（Railway PostgreSQL）**
資料庫部署於 Railway 平台的 PostgreSQL 15 服務，提供自動備份、監控告警、垂直擴展及高可用性配置。資料庫連線透過環境變數 `DATABASE_URL` 配置，採用加密連線（SSL）確保資料傳輸安全。Railway 提供詳細的監控儀表板，追蹤資料庫效能指標如 CPU 使用率、記憶體用量、連線數、查詢延遲等。

**AI 服務層（多重整合）**
系統整合雙 AI 服務提供者，確保功能多樣性與服務穩健性：

1. **Anthropic Claude API**：透過 `@anthropic-ai/sdk` 函式庫整合 Claude 模型，處理一般性對話與諮詢。API 金鑰儲存於環境變數 `ANTHROPIC_API_KEY`，並透過 Railway 部署的 Webhook 服務進行代理呼叫，避免前端直接暴露 API 金鑰。Webhook 服務支援 HTTP 代理配置，60 秒超時保護，詳細錯誤記錄與日誌追蹤。

2. **OpenAI GPT-4 API**：透過 N8N 平台整合 OpenAI API，處理意圖解析與專業報告生成。API 憑證配置於 N8N 的憑證管理系統，支援金鑰輪替與存取控制。

**工作流程自動化層（N8N）**
N8N 自動化平台部署為獨立服務，提供碳排放數據查詢與分析的智能工作流程。N8N 配置包含：

- **Webhook 端點**：對外提供 `/carbon-query` API 端點，接收來自主系統的查詢請求
- **資料庫連線**：配置 PostgreSQL 連線憑證（Postgres account），直接存取 Railway 資料庫進行查詢
- **AI 模型整合**：配置 OpenAI API 憑證（OpenAi account），調用 GPT-4O-Mini 模型
- **工作流程版本控制**：所有 workflow 定義以 JSON 格式匯出，納入版本控制系統
- **監控與日誌**：N8N 提供執行歷史記錄、錯誤追蹤、效能監控等功能

**環境變數配置**
系統敏感資訊皆透過環境變數管理，主要配置項目包括：

```bash
# 資料庫連線
DATABASE_URL="postgresql://user:password@host:port/database"

# AI 服務
ANTHROPIC_API_KEY="sk-ant-..."
OPENAI_API_KEY="sk-..."

# Webhook 服務
N8N_CARBON_QUERY_WEBHOOK_URL="https://n8n.example.com/webhook/carbon-query"

# 應用程式設定
NEXT_PUBLIC_APP_URL="https://app.example.com"
REPORTS_STORAGE_PATH="/tmp/reports"
```

**服務通訊架構**
各服務間的通訊流程如下：

```
使用者 → Vercel (前端) → N8N Webhook → Railway PostgreSQL
                      ↓
                 OpenAI GPT-4
                      ↓
              N8N (數據分析)
                      ↓
            Vercel (前端顯示)
```

此架構設計將運算密集的 AI 推論與數據分析工作分離至 N8N 平台，減輕主系統負載；同時透過 Webhook 機制實現鬆耦合，各服務可獨立擴展與維護。

## 五、系統特色與創新

### 5.1 智能工作流程驅動的數據分析

本系統的核心創新在於採用 N8N 自動化工作流程平台建構 AI 驅動的數據查詢與分析管道，突破傳統碳管理系統固定報表的限制。透過九節點智能工作流程，系統能夠：

1. **自然語言查詢理解**：使用者以日常語言提問（如「本月碳排放量多少？」），系統自動解析意圖、提取參數、計算時間範圍，無需使用者學習查詢語法。

2. **動態數據分析**：根據查詢參數即時從資料庫擷取數據，執行多維度統計分析，計算總量、平均值、極值、趨勢、百分比分佈等指標，提供完整的數據洞察。

3. **AI 生成專業報告**：整合 OpenAI GPT-4 模型，將統計數據轉化為易讀的專業報告，包含數據摘要、關鍵發現、趨勢分析及改善建議，使非技術人員也能快速理解碳排放狀況。

4. **可擴展的工作流程**：N8N 視覺化工作流程設計允許系統管理者輕鬆新增節點、調整邏輯、整合新的數據源或 AI 模型，無需修改主系統程式碼，大幅降低維護成本。

### 5.2 雙層 AI 架構的智能分工

系統創新性地整合 Anthropic Claude 與 OpenAI GPT-4 雙 AI 模型，實現智能分工：

- **Claude AI**：處理通用對話、減排諮詢、技術問答等開放性問題，擅長長文本理解與複雜推理
- **OpenAI GPT-4**：專注於結構化數據處理、意圖解析、專業報告生成，提供精確的數據分析

雙層架構避免單一 AI 模型的局限性，結合兩者優勢提供更全面的智能服務。通用對話與專業分析分離，確保響應速度與分析深度兼顧。

### 5.3 綠色製造與經濟效益的整合優化

本系統突破傳統碳管理系統僅提供數據記錄與報表功能的限制，整合綠色製造與經濟決策優化的數學模型。決策模型考量 25+ 個經濟與環境參數，透過網格搜索演算法求解最佳生產策略，同時評估經濟利潤與碳減排效益。敏感性分析功能協助企業識別關鍵影響因子，制定穩健的減排策略，在經濟效益與環境責任之間取得平衡。

### 5.4 完整的審計追蹤與合規支援

系統設計完善的資料稽核機制，所有使用者查詢皆記錄 user_id、username、chat_id、timestamp 等資訊，確保完整的審計追蹤。N8N 工作流程執行歷史記錄每次查詢的輸入、輸出、執行時間、錯誤資訊，符合內部控制與法規遵循要求。永續報告書生成功能支援 GRI、TCFD、SASB 等國際標準，協助企業滿足 ESG 揭露義務。

### 5.5 微服務架構的高可用性設計

系統採用分散式微服務架構，前端（Vercel）、資料庫（Railway）、AI 服務（Claude + OpenAI）、工作流程（N8N）各自獨立部署，透過 Webhook 與 API 通訊。此設計確保：

- **高可用性**：單一服務故障不影響其他服務運作
- **可擴展性**：各服務可獨立水平或垂直擴展，應對流量增長
- **彈性整合**：透過 Webhook 機制輕鬆整合新的業務系統或第三方服務
- **成本優化**：使用 Serverless 架構，依實際用量計費，降低閒置成本

### 5.6 響應式設計與跨平台支援

系統採用 Tailwind CSS 框架實現完整的響應式設計，確保在桌面電腦（1920px+）、筆記型電腦（1366px）、平板（768px）、手機（375px）等不同裝置上皆提供最佳的使用體驗。浮動式 AI 助理自適應螢幕尺寸，管理者可隨時隨地透過手機查詢碳排放狀況，即時掌握企業永續表現。

## 六、結論與展望

### 6.1 研究成果總結

本研究成功開發一套功能完整、技術先進的企業級碳足跡管理系統，實現以下重要成果：

**技術創新**：系統採用 N8N 自動化工作流程平台建構 AI 驅動的智能查詢管道，整合雙 AI 模型（Claude + GPT-4）實現自然語言查詢理解、動態數據分析與專業報告自動生成。九節點工作流程設計展現良好的模組化與可擴展性，為碳管理系統的智能化提供新的技術路徑。

**功能完整性**：系統涵蓋碳排放即時監控、綠色製造決策優化、碳盤查與管理報告生成、AI 智能助理、系統設定管理等完整功能，滿足企業從數據收集、分析、決策到報告揭露的全生命週期需求。特別是決策模型整合經濟與環境雙重目標，協助企業在追求利潤的同時實現減排承諾。

**架構優勢**：採用分散式微服務架構，前端（Vercel）、資料庫（Railway）、AI 服務（Claude + OpenAI）、工作流程（N8N）各自獨立部署，確保高可用性、可擴展性與維護便利性。Serverless 部署模式降低運維成本，全球 CDN 加速提升使用者體驗。

**實用價值**：系統符合 GRI、TCFD、SASB 等國際碳盤查與管理報告標準，協助企業滿足 ESG 揭露義務與法規遵循要求。完善的審計追蹤機制確保數據可信度，支援內部控制與外部查核需求。響應式設計使管理者能隨時隨地監控碳排放狀況，即時掌握永續績效。

### 6.2 未來發展方向

基於本研究成果，未來可朝以下方向持續擴展系統功能與應用範圍：

**供應鏈碳足跡追蹤**：整合供應商碳排放數據，建立完整的 Scope 3 排放追蹤機制，協助企業掌握價值鏈碳足跡，識別減排熱點，推動供應鏈綠色轉型。

**碳權交易管理**：開發碳權購買、出售、抵換管理功能，整合國際碳權交易市場資訊，協助企業制定碳中和策略，優化碳資產配置。

**AI 模型持續優化**：擴充 AI 訓練數據，提升意圖識別準確度；整合多模態 AI 模型，支援圖表、文件等多種格式的數據輸入；開發預測模型，提供碳排放趨勢預測與情境模擬功能。

**國際標準自動對接**：開發與 CDP（Carbon Disclosure Project）、SBTi（Science Based Targets initiative）等國際組織平台的自動對接功能，一鍵匯出符合各標準格式的報告，降低重複作業負擔。

**區塊鏈技術整合**：探索區塊鏈技術應用於碳排放數據不可竄改記錄與碳權交易溯源，提升數據可信度與交易透明度，建立企業永續公信力。

### 6.3 結語

隨著全球淨零排放目標的推進，企業碳管理需求將持續增長。本系統透過整合先進的 AI 技術、自動化工作流程與數學優化模型，為企業提供智能、高效、全方位的碳足跡管理解決方案。系統不僅是技術工具，更是企業實踐永續承諾、達成減排目標、提升 ESG 績效的重要夥伴。期待本研究能為碳管理系統的發展提供參考，推動更多企業邁向淨零未來。

---

**字數統計：約 3,800 字**